import{u as xe,r as o,j as e,S as b,L as U}from"./index-BwjIhAk5.js";import{X as fe,D as k}from"./DataTableSettings-DsshIM33.js";import{b as ge,c as je}from"./index-6cARXTD6.js";import{F as ve,a as be,b as Ge,c as ye,d as Ce,e as Ne}from"./index-BFbuKzBk.js";import{G as we,O as c}from"./index-BZ-hmF14.js";import{a as Se,b as Fe}from"./index-DqFMOxbS.js";import{a as Ee}from"./index-D0LwIwlf.js";import{L as Ie,y as h}from"./index-DBZWtKGJ.js";import{a as x}from"./AxiosInterceptor-C0G1OxbU.js";import{F as d}from"./Form-Cyv1odcU.js";import{B as g}from"./Button-BDb3Qyxz.js";import{I as m}from"./InputGroup-B5T7iIyR.js";import"./iconBase-i6NgAem3.js";import"./index-BjX9kMhX.js";import"./Col-BeHysn_4.js";const We=()=>{var V;const G=xe(),D=o.useRef(!1),[r,_]=o.useState({});o.useEffect(()=>{var t;(t=G.state)!=null&&t.permissions&&_(G.state.permissions)},[(V=G.state)==null?void 0:V.permissions]);const y={itemGroupId:"",itemGroupName:"",itemGroupCode:"",isActive:!1},A={File:""},u=[{label:"FinishedGoods",value:"1"},{label:"SemiFinishedGoods",value:"2"},{label:"RawMaterial",value:"3"},{label:"Consumables",value:"4"},{label:"SpareParts",value:"5"},{label:"PackagingMaterial",value:"6"},{label:"Service",value:"7"},{label:"Other",value:"8"}],[i,j]=o.useState(y),[p,v]=o.useState({}),[T,P]=o.useState(A),[z,H]=o.useState({}),[q,ke]=o.useState(!1),[L,W]=o.useState(""),[$,X]=o.useState([]),Z=["itemGroupName","itemGroupCode","isActive"],[C,N]=o.useState(!1),[Y,w]=o.useState(!1),[J,M]=o.useState(!1),[K,n]=o.useState(!1),[Q,S]=o.useState(!1),[f,F]=o.useState(null),R=()=>{w(!1),j(y),v({}),N(!1)},ee=()=>{j(y),N(!1),v({}),w(!0)},B=()=>M(!1),te=()=>M(!0);o.useEffect(()=>{D.current||(D.current=!0,E())},[]);const E=async()=>{var t,s;n(!0);try{const a=await x.get("/itemgroups"),l=(s=(t=a==null?void 0:a.data)==null?void 0:t.list)==null?void 0:s.sort((pe,he)=>new Date(he.createdDate)-new Date(pe.createdDate));X(l)}catch(a){console.error("Error fetching table data",a)}finally{n(!1)}},ae=async()=>{try{const t=await x.get("/itemgroups/exportexcel",{responseType:"blob"}),s=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),a=window.URL.createObjectURL(s),l=document.createElement("a");l.href=a,l.setAttribute("download","itemGroup.xlsx"),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(a)}catch(t){console.error("Error downloading the file:",t),alert("Failed to export file.")}},I=(t,s)=>{j(a=>({...a,[t]:s})),v(a=>({...a,[t]:""}))},se=(t,s)=>{P(a=>({...a,[t]:s})),H(a=>({...a,[t]:""}))},oe=()=>{const{itemGroupName:t,itemGroupCode:s}=i,a={};let l=!0;return t?/^[a-zA-Z ]+$/.test(t)||(a.itemGroupName="Name must contain only letters",l=!1):(l=!1,a.itemGroupName="Group name is required."),s||(l=!1,a.itemGroupCode="Group code is required."),v(a),l},re=()=>{const{File:t}=T,s={};let a=!0;return t?t.type!=="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"&&(a=!1,s.File="Only .xlsx files are allowed."):(a=!1,s.File="Import file is required."),H(s),a},ie=t=>{N(!0),j({itemGroupId:t.itemGroupId,itemGroupName:t.itemGroupName,itemGroupCode:t.itemGroupCode,isActive:t.isActive}),w(!0)},le=(t,s)=>{F({id:t,name:s}),S(!0)},ne=()=>{f&&(n(!0),x.delete(`/itemgroups/${f.id}`).then(t=>{h.success(t.data.successMessage||"Group deleted successfully!"),E()}).catch(t=>{console.error("Error deleting group:",t),h.error("Failed to delete group.")}).finally(()=>{n(!1),S(!1),F(null)}))},O=()=>{S(!1),F(null)},ce=[{name:e.jsx("h5",{children:"Group Name"}),selector:t=>t.itemGroupName,sortable:!0},{name:e.jsx("h5",{children:"Group Code"}),selector:t=>t.itemGroupCode,sortable:!0},{name:e.jsx("h5",{children:"Status"}),cell:t=>e.jsx("span",{style:{color:t.isActive?"#88E788":"#FF474C",fontWeight:"bold"},children:t.isActive?"Active":"Inactive"}),sortable:!0},{name:e.jsx("h5",{children:"Action"}),center:!0,cell:t=>e.jsxs(e.Fragment,{children:[(r==null?void 0:r.write)&&e.jsx(U,{className:"action-icon",onClick:()=>ie(t),children:e.jsx(Ne,{size:24,color:"#87CEEB"})}),(r==null?void 0:r.delete)&&e.jsx(U,{className:"action-icon",onClick:()=>le(t.itemGroupId,t.itemGroupName),children:e.jsx(je,{size:30,style:{margin:"1vh"},color:"#FF474C"})})]})}],de=o.useMemo(()=>e.jsxs("div",{className:"d-flex justify-content-end gap-2 align-items-center w-100",children:[e.jsx(d,{className:"d-flex",children:e.jsx(d.Control,{type:"search",placeholder:"Search...",className:"me-2 rounded-pill","aria-label":"Search",onChange:t=>W(t.target.value)})}),(r==null?void 0:r.import)&&e.jsxs(g,{variant:"info",onClick:te,children:[e.jsx(Se,{size:20})," Import"]}),(r==null?void 0:r.export)&&e.jsxs(g,{variant:"success",onClick:ae,children:[e.jsx(Fe,{size:20})," Export"]}),(r==null?void 0:r.write)&&e.jsxs(g,{variant:"warning",onClick:ee,children:[e.jsx(we,{size:20})," Add"]})]}),[r,L]),me=async t=>{if(t.preventDefault(),!oe())return;const s={itemGroupName:i.itemGroupName,itemGroupCode:i.itemGroupCode,isActive:i.isActive};n(!0);try{let a;C?a=await x.put(`/itemgroups/${i.itemGroupId}`,s):a=await x.post("/itemgroups",s),R(),E(),h.success(a.data.successMessage||"Success!")}catch{h.error("Something went wrong! Please try again.")}finally{n(!1)}},ue=async t=>{if(t.preventDefault(),!re())return;const s=new FormData;s.append("File",T.File),n(!0);try{const a=await x.post("/itemgroups/importexcel",s);h.success(a.data.successMessage||"File uploaded successfully!"),B(),P(A)}catch{h.error("Something went wrong! Please try again.")}finally{n(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(Ie,{}),Q&&e.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0, 0, 0, 0.5)",transition:"opacity 0.3s ease-in-out"},tabIndex:"-1",role:"dialog",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content border-0 shadow-lg rounded-4 animate__animated animate__fadeInDown",children:[e.jsxs("div",{className:"modal-header bg-danger text-white rounded-top-4",children:[e.jsxs("h5",{className:"modal-title d-flex align-items-center gap-2",children:[e.jsx(ve,{}),"Confirm Deletion"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:O})]}),e.jsx("div",{className:"modal-body text-center",children:e.jsxs("p",{className:"fs-5 mb-0",children:["Are you sure you want to delete"," ",e.jsx("strong",{children:f==null?void 0:f.name}),"?"]})}),e.jsxs("div",{className:"modal-footer justify-content-center border-0 pb-4",children:[e.jsxs("button",{type:"button",className:"btn btn-secondary rounded text-white px-4 d-flex align-items-center gap-2",onClick:O,children:[e.jsx(be,{}),"Cancel"]}),e.jsxs("button",{type:"button",className:"btn btn-danger text-white rounded px-4 shadow d-flex align-items-center gap-2",onClick:ne,children:[e.jsx(Ge,{}),"Yes, Delete"]})]})]})})}),K?e.jsxs("div",{className:"d-flex justify-content-center",style:{marginTop:"20%"},children:[e.jsx(b,{animation:"grow",variant:"secondary",size:"sm"}),e.jsx(b,{animation:"grow",variant:"warning"}),e.jsx(b,{animation:"grow",variant:"secondary",size:"sm"}),e.jsx(b,{animation:"grow",variant:"warning"})]}):e.jsx("div",{className:"d-flex",children:e.jsx("div",{className:"p-3",style:{width:"100vw"},children:e.jsx(fe,{className:"DataTable",columns:ce,data:k.filterItems($,Z,L),pagination:!0,paginationPerPage:k.paginationPerPage,paginationRowsPerPageOptions:k.paginationRowsPerPageOptions,progressPending:q,subHeader:!0,fixedHeaderScrollHeight:"400px",subHeaderComponent:de,persistTableHead:!0})})}),e.jsxs(c,{show:Y,onHide:R,placement:"end",backdrop:"false",style:{"--bs-offcanvas-width":"800px"},children:[e.jsx(c.Header,{closeButton:!0,children:e.jsx("div",{className:"w-100 text-center",children:e.jsx(c.Title,{style:{fontSize:"30px",fontWeight:600},children:C?"Edit Group":"Add Group"})})}),e.jsx(c.Body,{style:{marginTop:"-2vh"},children:e.jsxs(d,{className:"h-90",onSubmit:me,children:[e.jsxs(m,{className:"mb-4",children:[e.jsx(m.Text,{children:e.jsx(ge,{size:25,color:"#ffc800"})}),e.jsx(d.Control,{name:"itemGroupName",value:i.itemGroupName,onChange:t=>I("itemGroupName",t.target.value.replace(/[^a-zA-Z ]/g,"")),placeholder:"Group name",isInvalid:!!p.itemGroupName,isValid:i.itemGroupName&&!p.itemGroupName}),p.itemGroupName&&e.jsx("span",{className:"error-msg",children:p.itemGroupName})]}),e.jsxs(m,{className:"mb-3",children:[e.jsx(m.Text,{children:e.jsx(ye,{size:25,color:"#ffc800"})}),e.jsxs(d.Select,{name:"itemGroupCode",value:i.itemGroupCode||"",onChange:t=>I("itemGroupCode",t.target.value),children:[e.jsx("option",{value:"",children:"Select group code"}),i.itemGroupCode&&!(u!=null&&u.some(t=>t.value===i.itemGroupCode))&&e.jsx("option",{value:i.itemGroupCode,children:i.itemGroupCode}),u==null?void 0:u.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),p.itemGroupCode&&e.jsx("span",{className:"error-msg",children:p.itemGroupCode})]}),e.jsxs(m,{className:"mb-3",children:[e.jsx(m.Text,{children:e.jsx(Ee,{size:25,color:"#ffc800"})}),e.jsx(d.Check,{type:"checkbox",label:"IsActive",checked:i.isActive,onChange:t=>I("isActive",t.target.checked),className:"ms-3"})]}),e.jsx("div",{className:"d-flex justify-content-center mt-4",children:e.jsx(g,{type:"submit",variant:"warning",children:C?"Update":"Save"})})]})})]}),e.jsxs(c,{show:J,onHide:B,backdrop:"static",placement:"end",children:[e.jsx(c.Header,{closeButton:!0,children:e.jsx("div",{className:"w-100 text-center",children:e.jsx(c.Title,{style:{fontSize:"30px",fontWeight:600},children:"Add File"})})}),e.jsx(c.Body,{style:{marginTop:"-2vh"},children:e.jsxs(d,{className:"h-90",children:[e.jsxs(m,{className:"mb-3",children:[e.jsx(m.Text,{children:e.jsx(Ce,{size:25,color:"#ffc800"})}),e.jsx(d.Control,{type:"file",accept:".xlsx",name:"File",onChange:t=>{const s=t.target.files[0];se("File",s)}}),z.File&&e.jsx("span",{className:"error-msg",children:z.File})]}),e.jsx("div",{className:"d-flex justify-content-center mt-5",children:e.jsx(g,{type:"submit",variant:"warning",onClick:ue,children:"Save"})})]})})]})]})};export{We as default};
