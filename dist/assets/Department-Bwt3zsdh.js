import{u as ue,r,j as e,S as v,L as U}from"./index-BwjIhAk5.js";import{X as xe,D as I}from"./DataTableSettings-DsshIM33.js";import{b as fe,c as ge}from"./index-6cARXTD6.js";import{F as je,a as Ne,b as be,c as ve,d as ye,e as Se}from"./index-BFbuKzBk.js";import{a as h}from"./AxiosInterceptor-C0G1OxbU.js";import{L as we,y as u}from"./index-DBZWtKGJ.js";import{G as Ce,O as m}from"./index-BZ-hmF14.js";import{a as Fe,b as De}from"./index-DqFMOxbS.js";import{a as ke}from"./index-D0LwIwlf.js";import{F as i}from"./Form-Cyv1odcU.js";import{B as g}from"./Button-BDb3Qyxz.js";import{I as p}from"./InputGroup-B5T7iIyR.js";import"./iconBase-i6NgAem3.js";import"./index-BjX9kMhX.js";import"./Col-BeHysn_4.js";const Ge=()=>{var V;const y=ue(),[n,_]=r.useState({});r.useEffect(()=>{var t;(t=y.state)!=null&&t.permissions&&_(y.state.permissions)},[(V=y.state)==null?void 0:V.permissions]);const E=r.useRef(!1),j={deptId:"",deptName:"",deptShortName:"",isActive:!1},A={File:""},[l,x]=r.useState(j),[c,N]=r.useState({}),[T,P]=r.useState(A),[z,O]=r.useState({}),[q,Ie]=r.useState(!1),[H,G]=r.useState(""),[W,$]=r.useState([]),X=["deptName","deptShortName","isActive"],[S,b]=r.useState(!1),[Z,w]=r.useState(!1),[Y,L]=r.useState(!1),[J,d]=r.useState(!1),B=()=>L(!1),K=()=>L(!0),[Q,C]=r.useState(!1),[f,F]=r.useState(null),R=()=>{w(!1),x(j),N({}),b(!1)},ee=()=>{x(j),b(!1),N({}),w(!0)};r.useEffect(()=>{E.current||(E.current=!0,D())},[]);const D=async()=>{var t,s;d(!0);try{const a=await h.get("/department"),o=(s=(t=a==null?void 0:a.data)==null?void 0:t.list)==null?void 0:s.sort((pe,he)=>new Date(he.createdDate)-new Date(pe.createdDate));$(o)}catch(a){console.error("Error fetching table data",a)}finally{d(!1)}},te=async()=>{try{const t=await h.get("/department/exportexcel",{responseType:"blob"}),s=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),a=window.URL.createObjectURL(s),o=document.createElement("a");o.href=a,o.setAttribute("download","department.xlsx"),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(a)}catch(t){console.error("Error downloading the file:",t),alert("Failed to export file.")}},k=(t,s)=>{x(a=>({...a,[t]:s})),N(a=>({...a,[t]:""}))},ae=(t,s)=>{P(a=>({...a,[t]:s})),O(a=>({...a,[t]:""}))},se=()=>{const{deptName:t,deptShortName:s}=l,a={};let o=!0;return t?/^[a-zA-Z ]+$/.test(t)||(a.deptName="Name must contain only letters",o=!1):(o=!1,a.deptName="Department name is required."),s||(o=!1,a.deptShortName="Short name is required."),N(a),o},re=()=>{const{File:t}=T,s={};let a=!0;return t?t.type!=="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"&&(a=!1,s.File="Only .xlsx files are allowed."):(a=!1,s.File="Import file is required."),O(s),a},ne=t=>{b(!0),x({deptId:t.deptId,deptName:t.deptName,deptShortName:t.deptShortName,isActive:t.isActive}),w(!0)},oe=(t,s)=>{F({id:t,name:s}),C(!0)},le=()=>{f&&(d(!0),h.delete(`/department/${f.id}`).then(t=>{u.success(t.data.successMessage||"Department deleted successfully!"),D()}).catch(t=>{console.error("Error deleting department:",t),u.error("Failed to delete department.")}).finally(()=>{d(!1),C(!1),F(null)}))},M=()=>{C(!1),F(null)},ie=[{name:e.jsx("h5",{children:"Department Name"}),selector:t=>t.deptName,sortable:!0},{name:e.jsx("h5",{children:"Department short Name"}),selector:t=>t.deptShortName,sortable:!0},{name:e.jsx("h5",{children:"Status"}),cell:t=>e.jsx("span",{style:{color:t.isActive?"#88E788":"#FF474C",fontWeight:"bold"},children:t.isActive?"Active":"Inactive"}),sortable:!0},{name:e.jsx("h5",{children:"Action"}),center:!0,cell:t=>e.jsxs(e.Fragment,{children:[(n==null?void 0:n.write)&&e.jsx(U,{className:"action-icon",onClick:()=>ne(t),children:e.jsx(Se,{size:24,color:"#87CEEB"})}),(n==null?void 0:n.delete)&&e.jsx(U,{className:"action-icon",onClick:()=>oe(t.deptId,t.deptName),children:e.jsx(ge,{size:30,style:{margin:"1vh"},color:"#FF474C"})})]})}],ce=r.useMemo(()=>e.jsxs("div",{className:"d-flex justify-content-end gap-2 align-items-center w-100",children:[e.jsx(i,{className:"d-flex",children:e.jsx(i.Control,{type:"search",placeholder:"Search...",className:"me-2 rounded-pill","aria-label":"Search",onChange:t=>G(t.target.value)})}),(n==null?void 0:n.import)&&e.jsxs(g,{variant:"info",onClick:K,children:[e.jsx(Fe,{size:20})," Import"]}),(n==null?void 0:n.export)&&e.jsxs(g,{variant:"success",onClick:te,children:[e.jsx(De,{size:20})," Export"]}),(n==null?void 0:n.write)&&e.jsxs(g,{variant:"warning",onClick:ee,children:[e.jsx(Ce,{size:20})," Add"]})]}),[n,H]),de=async t=>{if(t.preventDefault(),!se())return;const s={deptName:l.deptName,deptShortName:l.deptShortName,isActive:l.isActive};d(!0);try{let a;S?a=await h.put(`/department/${l.deptId}`,s):a=await h.post("/department",s),x(j),b(!1),R(),D(),u.success(a.data.successMessage||"Success!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}catch{u.error(res.data.ErrorMessage||"Something went wrong! Please try again.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}finally{d(!1)}},me=async t=>{if(t.preventDefault(),!re())return;const s=new FormData;s.append("File",T.File),d(!0);try{const a=await h.post("/itemgroups/importexcel",s);u.success(a.data.successMessage||"File uploaded successfully!"),B(),P(A)}catch{u.error("Something went wrong! Please try again.")}finally{d(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(we,{}),Q&&e.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0, 0, 0, 0.5)",transition:"opacity 0.3s ease-in-out"},tabIndex:"-1",role:"dialog",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content border-0 shadow-lg rounded-4 animate__animated animate__fadeInDown",children:[e.jsxs("div",{className:"modal-header bg-danger text-white rounded-top-4",children:[e.jsxs("h5",{className:"modal-title d-flex align-items-center gap-2",children:[e.jsx(je,{}),"Confirm Deletion"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:M})]}),e.jsx("div",{className:"modal-body text-center",children:e.jsxs("p",{className:"fs-5 mb-0",children:["Are you sure you want to delete"," ",e.jsx("strong",{children:f==null?void 0:f.name}),"?"]})}),e.jsxs("div",{className:"modal-footer justify-content-center border-0 pb-4",children:[e.jsxs("button",{type:"button",className:"btn btn-secondary rounded text-white px-4 d-flex align-items-center gap-2",onClick:M,children:[e.jsx(Ne,{}),"Cancel"]}),e.jsxs("button",{type:"button",className:"btn btn-danger text-white rounded px-4 shadow d-flex align-items-center gap-2",onClick:le,children:[e.jsx(be,{}),"Yes, Delete"]})]})]})})}),J?e.jsxs("div",{className:"d-flex justify-content-center",style:{marginTop:"20%"},children:[e.jsx(v,{animation:"grow",variant:"secondary",size:"sm"}),e.jsx(v,{animation:"grow",variant:"warning"}),e.jsx(v,{animation:"grow",variant:"secondary",size:"sm"}),e.jsx(v,{animation:"grow",variant:"warning"})]}):e.jsx("div",{className:"d-flex",children:e.jsx("div",{className:"p-3",style:{width:"100vw"},children:e.jsx("div",{style:{width:"100%"},children:e.jsx(xe,{className:"DataTable",columns:ie,data:I.filterItems(W,X,H),pagination:!0,paginationPerPage:I.paginationPerPage,paginationRowsPerPageOptions:I.paginationRowsPerPageOptions,progressPending:q,subHeader:!0,fixedHeaderScrollHeight:"400px",subHeaderComponent:ce,persistTableHead:!0})})})}),e.jsxs(m,{show:Z,onHide:R,placement:"end",backdrop:"false",style:{"--bs-offcanvas-width":"800px"},children:[e.jsx(m.Header,{closeButton:!0,children:e.jsx("div",{className:"w-100 text-center",children:e.jsx(m.Title,{style:{fontSize:"30px",fontWeight:600},children:S?"Edit Department":"Add Department"})})}),e.jsx(m.Body,{style:{marginTop:"-2vh"},children:e.jsxs(i,{className:"h-90",onSubmit:de,children:[e.jsxs(p,{className:"mb-4",children:[e.jsx(p.Text,{id:"deptName",children:e.jsx(fe,{size:25,color:"#ffc800"})}),e.jsx(i.Control,{name:"deptName",value:l.deptName||"",onChange:t=>k("deptName",t.target.value.replace(/[^a-zA-Z ]/g,"")),placeholder:"Department name","aria-label":"deptName",isInvalid:!!c.deptName,isValid:l.deptName&&!c.deptName,autoComplete:"off"}),c.deptName&&e.jsx("span",{className:"error-msg",children:c.deptName})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(p.Text,{id:"deptShortName",children:e.jsx(ve,{size:25,color:"#ffc800"})}),e.jsx(i.Control,{name:"deptShortName",value:l.deptShortName||"",onChange:t=>k("deptShortName",t.target.value),placeholder:"Department short name","aria-label":"deptShortName",isInvalid:!!c.deptShortName,isValid:l.deptShortName&&!c.deptShortName,autoComplete:"off"}),c.deptShortName&&e.jsx("span",{className:"error-msg",children:c.deptShortName})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(p.Text,{id:"isActive",children:e.jsx(ke,{size:25,color:"#ffc800"})}),e.jsxs(i.Check,{type:"checkbox",id:"custom-checkbox",label:"IsActive",name:"isActive",className:"ms-3",style:{display:"flex",alignItems:"center",fontSize:"1rem"},custom:"true",children:[e.jsx(i.Check.Input,{type:"checkbox",checked:l.isActive,onChange:t=>k("isActive",t.target.checked),style:{width:"20px",height:"20px",cursor:"pointer",marginRight:"8px"}}),e.jsx(i.Check.Label,{htmlFor:"custom-checkbox",children:"IsActive"})]})]}),e.jsx("div",{className:"d-flex justify-content-center mt-4",children:e.jsx(g,{type:"submit",variant:"warning",children:S?"Update":"Save"})})]})})]}),e.jsxs(m,{show:Y,onHide:B,backdrop:"static",placement:"end",children:[e.jsx(m.Header,{closeButton:!0,children:e.jsx("div",{className:"w-100 text-center",children:e.jsx(m.Title,{style:{fontSize:"30px",fontWeight:600},children:"Add File"})})}),e.jsx(m.Body,{style:{marginTop:"-2vh"},children:e.jsxs(i,{className:"h-90",children:[e.jsxs(p,{className:"mb-3",children:[e.jsx(p.Text,{children:e.jsx(ye,{size:25,color:"#ffc800"})}),e.jsx(i.Control,{type:"file",accept:".xlsx",name:"File",onChange:t=>{const s=t.target.files[0];ae("File",s)}}),z.File&&e.jsx("span",{className:"error-msg",children:z.File})]}),e.jsx("div",{className:"d-flex justify-content-center mt-5",children:e.jsx(g,{type:"submit",variant:"warning",onClick:me,children:"Save"})})]})})]})]})};export{Ge as default};
