import{u as fe,r,j as e,S as N,L as q}from"./index-BwjIhAk5.js";import{X as ye,D as T}from"./DataTableSettings-DsshIM33.js";import{c as Ce}from"./index-6cARXTD6.js";import{F as je,a as be,b as ve,f as Ne,d as Se,e as Ie}from"./index-BFbuKzBk.js";import{a as g}from"./AxiosInterceptor-C0G1OxbU.js";import{L as we,y as p}from"./index-DBZWtKGJ.js";import{a as Fe}from"./index-CYpNFU1B.js";import{a as ke}from"./index-C7jdaNTX.js";import{a as Ee,b as Te}from"./index-DqFMOxbS.js";import{a as Ae}from"./index-D0LwIwlf.js";import{G as Ge,O as u}from"./index-BZ-hmF14.js";import{F as l}from"./Form-Cyv1odcU.js";import{B as y}from"./Button-BDb3Qyxz.js";import{I as m}from"./InputGroup-B5T7iIyR.js";import"./iconBase-i6NgAem3.js";import"./index-BjX9kMhX.js";import"./Col-BeHysn_4.js";const Ye=()=>{var U;const S=fe(),[o,_]=r.useState({});r.useEffect(()=>{var t;(t=S.state)!=null&&t.permissions&&_(S.state.permissions)},[(U=S.state)==null?void 0:U.permissions]);const C={itemCategoryId:"",itemCategoryName:"",itemSubGroupId:"",itemCategoryCode:"",isActive:!1},A={File:""},[i,h]=r.useState(C),[c,j]=r.useState({}),[G,z]=r.useState(A),[D,P]=r.useState({}),H=r.useRef(!1),[W,$]=r.useState(!1),[O,X]=r.useState(""),[Z,Y]=r.useState([]),[L,b]=r.useState(!1),[J,I]=r.useState(!1),[w,K]=r.useState([]),Q=["itemCategoryName","itemSubGroupName","itemCategoryCode","isActive"],[ee,F]=r.useState(!1),[x,k]=r.useState(null),[te,R]=r.useState(!1),[ae,d]=r.useState(!1),V=()=>R(!1),se=()=>R(!0),B=()=>{I(!1),h(C),j({}),b(!1)},re=()=>{h(C),b(!1),j({}),I(!0),oe()};r.useEffect(()=>{H.current||(H.current=!0,E())},[]);const E=async()=>{var t;d(!0);try{const a=await g.get("/itemcategory");Y((t=a==null?void 0:a.data)==null?void 0:t.list)}catch(a){console.error("Error fetching table data",a),$(!1)}finally{d(!1)}},oe=async()=>{var t;d(!0);try{const a=await g.get("/itemsubgroups");K((t=a==null?void 0:a.data)==null?void 0:t.list)}catch(a){console.error("Error fetching subgroup data",a)}finally{d(!1)}},ie=async()=>{try{const t=await g.get("/itemcategory/exportexcel",{responseType:"blob"}),a=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=window.URL.createObjectURL(a),n=document.createElement("a");n.href=s,n.setAttribute("download","itemCategory.xlsx"),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(s)}catch(t){console.error("Error downloading the file:",t),alert("Failed to export file.")}},v=(t,a)=>{h(s=>({...s,[t]:a})),j(s=>({...s,[t]:""}))},ne=(t,a)=>{z(s=>({...s,[t]:a})),P(s=>({...s,[t]:""}))},le=t=>{b(!0),h({itemCategoryId:t.itemCategoryId,itemCategoryName:t.itemCategoryName,itemSubGroupId:t.itemSubGroupId,itemCategoryCode:t.itemCategoryCode,isActive:t.isActive}),I(!0)},ce=(t,a)=>{k({id:t,name:a}),F(!0)},de=()=>{x&&(d(!0),g.delete(`/itemtypes/${x.id}`).then(t=>{p.success(t.data.successMessage||"Category deleted successfully!"),E()}).catch(t=>{console.error("Error deleting category:",t),p.error("Failed to delete category.")}).finally(()=>{d(!1),F(!1),k(null)}))},M=()=>{F(!1),k(null)},me=[{name:e.jsx("h5",{children:"Category Name"}),selector:t=>t.itemCategoryName,sortable:!0},{name:e.jsx("h5",{children:"Sub Group Name"}),selector:t=>t.itemSubGroupName,sortable:!0},{name:e.jsx("h5",{children:"Category Code"}),selector:t=>t.itemCategoryCode,sortable:!0},{name:e.jsx("h5",{children:"Status"}),cell:t=>e.jsx("span",{style:{color:t.isActive?"#88E788":"#FF474C",fontWeight:"bold"},children:t.isActive?"Active":"Inactive"}),sortable:!0},{name:e.jsx("h5",{children:"Action"}),center:!0,cell:t=>e.jsxs(e.Fragment,{children:[(o==null?void 0:o.write)&&e.jsx(q,{className:"action-icon",onClick:()=>le(t),children:e.jsx(Ie,{size:24,color:"#87CEEB"})}),(o==null?void 0:o.delete)&&e.jsx(q,{className:"action-icon",onClick:()=>ce(t.itemCategoryId,t.itemCategoryName),children:e.jsx(Ce,{size:30,style:{margin:"1vh"},color:"#FF474C"})})]})}],ue=r.useMemo(()=>e.jsxs("div",{className:"d-flex justify-content-end gap-2 align-items-center w-100",children:[e.jsx(l,{className:"d-flex",children:e.jsx(l.Control,{type:"search",placeholder:"Search...",className:"me-2 rounded-pill","aria-label":"Search",onChange:t=>X(t.target.value)})}),(o==null?void 0:o.import)&&e.jsxs(y,{variant:"info",onClick:se,children:[e.jsx(Ee,{size:20})," Import"]}),(o==null?void 0:o.export)&&e.jsxs(y,{variant:"success",onClick:ie,children:[e.jsx(Te,{size:20})," Export"]}),(o==null?void 0:o.write)&&e.jsxs(y,{variant:"warning",onClick:re,children:[e.jsx(Ge,{size:20})," Add"]})]}),[o,O]),ge=()=>{const{itemCategoryName:t,itemSubGroupId:a,itemCategoryCode:s}=i,n={};let f=!0;return t?/^[a-zA-Z ]+$/.test(t)||(n.itemCategoryName="Name must contain only letters",f=!1):(f=!1,n.itemCategoryName="Category name is required."),a||(f=!1,n.itemSubGroupId="Sub group name is required"),s||(f=!1,n.itemCategoryCode="Category code is required"),j(n),f},pe=()=>{const{File:t}=G,a={};let s=!0;return t?t.type!=="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"&&(s=!1,a.File="Only .xlsx files are allowed."):(s=!1,a.File="Import file is required."),P(a),s},he=async t=>{if(t.preventDefault(),!ge())return;const a={itemCategoryName:i.itemCategoryName,itemSubGroupId:i.itemSubGroupId,itemCategoryCode:i.itemCategoryCode,isActive:i.isActive};d(!0);try{let s;i.itemCategoryId?s=await g.put(`/itemcategory/${i.itemCategoryId}`,a):s=await g.post("/itemcategory",a),h(C),b(!1),B(),E(),p.success(s.data.successMessage||"Success!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}catch(s){console.error("API Error:",s),p.error("Something went wrong! Please try again.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}finally{d(!1)}},xe=async t=>{if(t.preventDefault(),!pe())return;const a=new FormData;a.append("File",G.File),d(!0);try{const s=await g.post("/itemcategory/importexcel",a);p.success(s.data.successMessage||"File uploaded successfully!"),V(),z(A)}catch{p.error("Something went wrong! Please try again.")}finally{d(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(we,{}),ee&&e.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0, 0, 0, 0.5)",transition:"opacity 0.3s ease-in-out"},tabIndex:"-1",role:"dialog",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content border-0 shadow-lg rounded-4 animate__animated animate__fadeInDown",children:[e.jsxs("div",{className:"modal-header bg-danger text-white rounded-top-4",children:[e.jsxs("h5",{className:"modal-title d-flex align-items-center gap-2",children:[e.jsx(je,{}),"Confirm Deletion"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:M})]}),e.jsx("div",{className:"modal-body text-center",children:e.jsxs("p",{className:"fs-5 mb-0",children:["Are you sure you want to delete"," ",e.jsx("strong",{children:x==null?void 0:x.name}),"?"]})}),e.jsxs("div",{className:"modal-footer justify-content-center border-0 pb-4",children:[e.jsxs("button",{type:"button",className:"btn btn-secondary rounded text-white px-4 d-flex align-items-center gap-2",onClick:M,children:[e.jsx(be,{}),"Cancel"]}),e.jsxs("button",{type:"button",className:"btn btn-danger text-white rounded px-4 shadow d-flex align-items-center gap-2",onClick:de,children:[e.jsx(ve,{}),"Yes, Delete"]})]})]})})}),ae?e.jsxs("div",{className:"d-flex justify-content-center",style:{marginTop:"20%"},children:[e.jsx(N,{animation:"grow",variant:"secondary",size:"sm"}),e.jsx(N,{animation:"grow",variant:"warning"}),e.jsx(N,{animation:"grow",variant:"secondary",size:"sm"}),e.jsx(N,{animation:"grow",variant:"warning"})]}):e.jsx("div",{className:"d-flex",children:e.jsx("div",{className:"p-3",style:{width:"100vw"},children:e.jsx("div",{className:"",style:{width:"100%"},children:e.jsx(ye,{columns:me,data:T.filterItems(Z,Q,O),pagination:!0,paginationPerPage:T.paginationPerPage,paginationRowsPerPageOptions:T.paginationRowsPerPageOptions,progressPending:W,subHeader:!0,fixedHeaderScrollHeight:"400px",subHeaderComponent:ue,persistTableHead:!0})})})}),e.jsxs(u,{show:J,onHide:B,placement:"end",backdrop:"false",style:{"--bs-offcanvas-width":"800px"},children:[e.jsx(u.Header,{closeButton:!0,children:e.jsx("div",{className:"w-100 text-center",children:e.jsx(u.Title,{style:{fontSize:"30px",fontWeight:600},children:L?"Edit Item Category":"Add Item Category"})})}),e.jsx(u.Body,{style:{marginTop:"-2vh"},children:e.jsxs(l,{className:"h-100",onSubmit:he,children:[e.jsxs(m,{className:"mb-4",children:[e.jsx(m.Text,{id:"itemCategoryName",children:e.jsx(Fe,{size:25,color:"#ffc800"})}),e.jsx(l.Control,{name:"itemCategoryName",value:i.itemCategoryName||"",onChange:t=>v("itemCategoryName",t.target.value.replace(/[^a-zA-Z ]/g,"")),placeholder:"Category name","aria-label":"itemCategoryName",isInvalid:!!c.itemCategoryName,isValid:i.itemCategoryName&&!c.itemCategoryName}),c.itemCategoryName&&e.jsx("span",{className:"error-msg",children:c.itemCategoryName})]}),e.jsxs(m,{className:"mb-4",children:[e.jsx(m.Text,{id:"itemCategoryCode",children:e.jsx(Ne,{size:25,color:"#ffc800"})}),e.jsx(l.Control,{name:"itemCategoryCode",value:i.itemCategoryCode||"",onChange:t=>v("itemCategoryCode",t.target.value),placeholder:"Category code","aria-label":"itemCategoryCode",isInvalid:!!c.itemCategoryCode,isValid:i.itemCategoryCode&&!c.itemCategoryCode}),c.itemCategoryCode&&e.jsx("span",{className:"error-msg",children:c.itemCategoryCode})]}),e.jsxs(m,{className:"mb-4",children:[e.jsx(m.Text,{id:"itemSubGroupId",children:e.jsx(ke,{size:25,color:"#ffc800"})}),e.jsxs(l.Select,{name:"itemSubGroupId",value:i.itemSubGroupId||"",onChange:t=>v("itemSubGroupId",t.target.value),children:[e.jsx("option",{children:"Select sub group"}),w==null?void 0:w.map(t=>e.jsx("option",{value:t.itemSubGroupId,children:t.itemSubGroupName},t.itemSubGroupId))]}),c.itemSubGroupId&&e.jsx("span",{className:"error-msg",children:c.itemSubGroupId})]}),e.jsxs(m,{className:"mb-3",children:[e.jsx(m.Text,{id:"IsActive",children:e.jsx(Ae,{size:25,color:"#ffc800"})}),e.jsxs(l.Check,{type:"checkbox",id:"custom-checkbox",label:"IsActive",name:"IsActive",className:"ms-3",style:{display:"flex",alignItems:"center",fontSize:"1rem"},custom:"true",children:[e.jsx(l.Check.Input,{type:"checkbox",checked:i.isActive,onChange:t=>v("isActive",t.target.checked),style:{width:"20px",height:"20px",cursor:"pointer",marginRight:"8px"}}),e.jsx(l.Check.Label,{htmlFor:"custom-checkbox",children:"IsActive"})]})]}),e.jsx("div",{className:"d-flex justify-content-center mt-5",children:e.jsx(y,{type:"submit",variant:"warning",children:L?"Update":"Save"})})]})})]}),e.jsxs(u,{show:te,onHide:V,backdrop:"static",placement:"end",children:[e.jsx(u.Header,{closeButton:!0,children:e.jsx("div",{className:"w-100 text-center",children:e.jsx(u.Title,{style:{fontSize:"30px",fontWeight:600},children:"Add File"})})}),e.jsx(u.Body,{style:{marginTop:"-2vh"},children:e.jsxs(l,{className:"h-90",children:[e.jsxs(m,{className:"mb-3",children:[e.jsx(m.Text,{children:e.jsx(Se,{size:25,color:"#ffc800"})}),e.jsx(l.Control,{type:"file",accept:".xlsx",name:"File",onChange:t=>{const a=t.target.files[0];ne("File",a)}}),D.File&&e.jsx("span",{className:"error-msg",children:D.File})]}),e.jsx("div",{className:"d-flex justify-content-center mt-5",children:e.jsx(y,{type:"submit",variant:"warning",onClick:xe,children:"Save"})})]})})]})]})};export{Ye as default};
