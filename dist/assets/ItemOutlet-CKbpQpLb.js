import{u as A,e as Q,r as o,j as e}from"./index-BwjIhAk5.js";import{e as y,d as M}from"./index-D0LwIwlf.js";import{r as V}from"./index-6cARXTD6.js";import{d as H,e as p}from"./index-D6nvb1sw.js";import{a as W}from"./AxiosInterceptor-C0G1OxbU.js";import"./iconBase-i6NgAem3.js";const X=()=>{var P,O,S,C,R,k;const d=(P=A().state)==null?void 0:P.formData,j=Q(),f=o.useRef(!1),u=o.useRef(),[i,g]=o.useState(null),[v,I]=o.useState({top:0,left:0}),[r,m]=o.useState({}),[h,E]=o.useState([]),[x,F]=o.useState([]);o.useEffect(()=>{f.current||(f.current=!0,z())},[]);const z=async()=>{var t,a;try{const s=await W.get("/outlets"),n=(a=(t=s==null?void 0:s.data)==null?void 0:t.list)==null?void 0:a.sort((c,l)=>new Date(l.createdDate)-new Date(c.createdDate));F(n)}catch(s){console.error("Error fetching outlet data",s)}},b=t=>{u.current&&!u.current.contains(t.target)&&i&&(N(i),g(null))};o.useEffect(()=>(document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)),[i]);const T=(t,a,s)=>{const n=s.currentTarget.getBoundingClientRect();I({top:n.bottom+window.scrollY,left:n.left}),i&&i!==t&&N(i),g(t),m(c=>({...c,[t]:{...c[t],outletId:a}}))},N=t=>{h.includes(t)||E(a=>[...a,t])},$=t=>{const{name:a,value:s,type:n,checked:c}=t.target,l=n==="checkbox"?c:s;m(w=>({...w,[i]:{...w[i],[a]:l}}))},D=[{name:"All",id:"all"},...x==null?void 0:x.map(t=>({name:t.outletName,id:t.outletID}))],L=()=>{const t=Object.entries(r).filter(([s,n])=>(n==null?void 0:n.rates)&&Object.keys(n.rates).length>0);if(t.length===0){alert("Please fill in price data for at least one outlet.");return}const a=t.map(([s,n])=>({outletName:s,outletId:n.outletId,prices:Object.entries(n.rates||{}).map(([c,l])=>({itemQuantity:n.itemQuantity||1,itemSize:c,itemPrice:parseFloat(l),isSoldMRP:n.isMRP||!1,isDiscountable:!0,isVisible:!0,isActive:!0}))}));j("/item-tax",{state:{itemData:d,outletData:a}})},B=t=>h.includes(t);return e.jsx("div",{className:"d-flex overflow-hidden",children:e.jsxs("div",{className:"configurationFormContainer",children:[e.jsxs("div",{className:"configurationFormWrapper",children:[e.jsx("div",{className:"configurationgroupFormHeader",children:e.jsxs("h2",{children:["Item ",e.jsx("span",{children:"Outlet Mapping"})]})}),e.jsx("div",{className:"outlets shadow-sm d-flex align-items-center flex-wrap",children:D.map((t,a)=>e.jsx("div",{className:`shadow-sm outlet ${B(t.name)?"selected":""}`,onClick:s=>T(t.name,t.id,s),children:t.name},a))}),e.jsxs("div",{className:"table-container shadow-sm rounded-2",children:[e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{children:[e.jsx(V,{})," Sl No"]}),e.jsxs("th",{children:[e.jsx(H,{})," Item Name"]}),e.jsxs("th",{children:[e.jsx(p,{})," Outlet"]}),e.jsxs("th",{children:[e.jsx(p,{})," Price"]}),e.jsxs("th",{children:[e.jsx(p,{})," MRP"]})]})}),e.jsx("tbody",{children:h.map((t,a)=>{var s,n;return e.jsxs("tr",{children:[e.jsx("td",{children:a+1}),e.jsx("td",{children:d==null?void 0:d.itemName}),e.jsx("td",{children:t}),e.jsx("td",{children:Object.entries(((s=r[t])==null?void 0:s.rates)||{}).map(([c,l])=>`${c}: ${l}`).join(", ")}),e.jsx("td",{children:(n=r[t])!=null&&n.isMRP?"True":"False"})]},a)})})]}),e.jsxs("div",{className:"pagination",children:[e.jsx(y,{}),e.jsx("div",{children:"Page"}),e.jsx(M,{})]})]}),e.jsxs("div",{className:"bottomBtn d-flex align-items-center justify-content-between",children:[e.jsxs("div",{className:"prevBtn",onClick:()=>j("/item"),children:[" ",e.jsx(y,{})," Previous "]}),e.jsxs("div",{className:"nextBtn",onClick:L,children:[" Next ",e.jsx(M,{})," "]})]})]}),i&&e.jsxs("div",{ref:u,className:"popup animated-popup",style:{top:v.top+10,left:v.left},children:[e.jsxs("div",{className:"toggle-container mb-2",children:[e.jsxs("label",{className:"switch",children:[e.jsx("input",{type:"checkbox",name:"isMRP",checked:((O=r[i])==null?void 0:O.isMRP)||!1,onChange:$}),e.jsx("span",{className:"slider round"})]}),e.jsx("span",{className:"toggle-label",children:"isMRP"})]}),e.jsx("div",{className:"size-toggle mb-2",children:["Small","Medium","Large"].map(t=>{var a;return e.jsx("button",{type:"button",className:`size-btn ${((a=r[i])==null?void 0:a.selectedSize)===t?"active":""}`,onClick:()=>m(s=>({...s,[i]:{...s[i],selectedSize:t}})),children:t},t)})}),e.jsx("div",{className:"form-group",children:e.jsx("input",{type:"text",name:"itemPrice",placeholder:`Rate for ${((S=r[i])==null?void 0:S.selectedSize)||""}`,className:"form-control",autoComplete:"off",value:((k=(C=r[i])==null?void 0:C.rates)==null?void 0:k[(R=r[i])==null?void 0:R.selectedSize])||"",onChange:t=>{var s;const a=t.target.value;if(/^\d*$/.test(a)){const n=(s=r[i])==null?void 0:s.selectedSize;m(c=>{var l;return{...c,[i]:{...c[i],rates:{...(l=c[i])==null?void 0:l.rates,[n]:a}}}})}}})})]})]})})};export{X as default};
