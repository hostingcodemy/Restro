import{r as i,u as ge,j as e,S as A,L as W}from"./index-BwjIhAk5.js";import{X as je,D as z}from"./DataTableSettings-DsshIM33.js";import{l as b,c as ve}from"./index-6cARXTD6.js";import{F as be,a as Ne,b as ye,d as Fe,e as Te}from"./index-BFbuKzBk.js";import{a as p}from"./AxiosInterceptor-C0G1OxbU.js";import{L as Ae,y as g}from"./index-DBZWtKGJ.js";import{G as Ce,O as x}from"./index-BZ-hmF14.js";import{a as we,b as Se}from"./index-DqFMOxbS.js";import{a as Re}from"./index-D0LwIwlf.js";import{H as Ie}from"./index-BLfT6YWF.js";import{F as c}from"./Form-Cyv1odcU.js";import{B as N}from"./Button-BDb3Qyxz.js";import{I as l}from"./InputGroup-B5T7iIyR.js";import"./iconBase-i6NgAem3.js";import"./index-BjX9kMhX.js";import"./Col-BeHysn_4.js";const Xe=()=>{var G;const y={taxId:"",taxName:"",taxRate:"",fromAmount:"",toAmount:"",restrictedFrom:"",restrictedTo:""},P={File:""},[o,j]=i.useState(y),[s,F]=i.useState({}),[H,O]=i.useState(P),[V,L]=i.useState({}),C=ge(),[n,X]=i.useState({});i.useEffect(()=>{var t;(t=C.state)!=null&&t.permissions&&X(C.state.permissions)},[(G=C.state)==null?void 0:G.permissions]);const B=i.useRef(!1),[Y,ke]=i.useState(!1),[M,J]=i.useState(""),[K,Q]=i.useState([]),Z=["taxName","taxRate","isActive"],[w,T]=i.useState(!1),[ee,S]=i.useState(!1),[te,q]=i.useState(!1),[ae,m]=i.useState(!1),$=()=>q(!1),se=()=>q(!0),[re,R]=i.useState(!1),[v,I]=i.useState(null),U=()=>{S(!1),j(y),F({}),T(!1)},oe=()=>{j(y),T(!1),F({}),S(!0)};i.useEffect(()=>{B.current||(B.current=!0,k())},[]);const f=(t,r)=>{j(a=>({...a,[t]:r})),F(a=>({...a,[t]:""}))},ie=(t,r)=>{O(a=>({...a,[t]:r})),L(a=>({...a,[t]:""}))},k=async()=>{var t,r;m(!0);try{const a=await p.get("/tax"),d=(r=(t=a==null?void 0:a.data)==null?void 0:t.list)==null?void 0:r.sort((E,D)=>new Date(D.createdDate)-new Date(E.createdDate));Q(d)}catch(a){console.error("Error fetching table data",a)}finally{m(!1)}},ne=async()=>{try{const t=await p.get("/tax/exportexcel",{responseType:"blob"}),r=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),a=window.URL.createObjectURL(r),d=document.createElement("a");d.href=a,d.setAttribute("download","tax.xlsx"),document.body.appendChild(d),d.click(),d.remove(),window.URL.revokeObjectURL(a)}catch(t){console.error("Error downloading the file:",t),alert("Failed to export file.")}},le=()=>{const{taxName:t,taxRate:r,fromAmount:a,toAmount:d,restrictedFrom:E,restrictedTo:D}=o,u={};let h=!0;return t||(h=!1,u.taxName="Tax name is required."),r||(h=!1,u.taxRate="Tax rate is required."),a||(h=!1,u.fromAmount="From Amount is required."),d||(h=!1,u.toAmount="To Amount is required."),E||(h=!1,u.restrictedFrom="Restricted From is required."),D||(h=!1,u.restrictedTo="Restricted To is required."),F(u),h},ce=()=>{const{File:t}=H,r={};let a=!0;return t?t.type!=="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"&&(a=!1,r.File="Only .xlsx files are allowed."):(a=!1,r.File="Import file is required."),L(r),a},de=t=>{T(!0),j({taxId:t.taxId,taxName:t.taxName,taxRate:t.taxRate,fromAmount:t.fromAmount,toAmount:t.toAmount,restrictedFrom:t.restrictedFrom,restrictedTo:t.restrictedTo,isActive:t.isActive}),S(!0)},me=(t,r)=>{I({id:t,name:r}),R(!0)},xe=()=>{v&&(m(!0),p.delete(`/taxs/${v.id}`).then(t=>{g.success(t.data.successMessage||"Tax deleted successfully!"),k()}).catch(t=>{console.error("Error deleting tax:",t),g.error("Failed to delete tax.")}).finally(()=>{m(!1),R(!1),I(null)}))},_=()=>{R(!1),I(null)},ue=[{name:e.jsx("h5",{children:"Tax Name"}),selector:t=>t.taxName,sortable:!0},{name:e.jsx("h5",{children:"Tax Rate"}),selector:t=>t.taxRate,sortable:!0},{name:e.jsx("h5",{children:"Status"}),cell:t=>e.jsx("span",{style:{color:t.isActive?"#88E788":"#FF474C",fontWeight:"bold"},children:t.isActive?"Active":"Inactive"}),sortable:!0},{name:e.jsx("h5",{children:"Action"}),center:!0,cell:t=>e.jsxs(e.Fragment,{children:[(n==null?void 0:n.write)&&e.jsx(W,{className:"action-icon",onClick:()=>de(t),children:e.jsx(Te,{size:24,color:"#87CEEB"})}),(n==null?void 0:n.delete)&&e.jsx(W,{className:"action-icon",onClick:()=>me(t.taxId,t.taxName),children:e.jsx(ve,{size:30,style:{margin:"1vh"},color:"#FF474C"})})]})}],he=i.useMemo(()=>e.jsxs("div",{className:"d-flex justify-content-end gap-2 align-items-center w-100",children:[e.jsx(c,{className:"d-flex",children:e.jsx(c.Control,{type:"search",placeholder:"Search...",className:"me-2 rounded-pill","aria-label":"Search",onChange:t=>J(t.target.value)})}),(n==null?void 0:n.import)&&e.jsxs(N,{variant:"info",onClick:se,children:[e.jsx(we,{size:20})," Import"]}),(n==null?void 0:n.export)&&e.jsxs(N,{variant:"success",onClick:ne,children:[e.jsx(Se,{size:20})," Export"]}),(n==null?void 0:n.write)&&e.jsxs(N,{variant:"warning",onClick:oe,children:[e.jsx(Ce,{size:20})," Add"]})]}),[n,M]),fe=async t=>{if(t.preventDefault(),!le())return;const r={taxName:o.taxName,taxRate:o.taxRate,fromAmt:o.fromAmt,toAmt:o.toAmt,restrictedFrom:o.restrictedFrom,restrictedTo:o.restrictedTo,isActive:o.isActive};m(!0);try{let a;w?a=await p.put(`/tax/${o.taxId}`,r):a=await p.post("/tax",r),j(y),T(!1),U(),k(),g.success(a.data.successMessage||"Success!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}catch{g.error(res.data.ErrorMessage||"Something went wrong! Please try again.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}finally{m(!1)}},pe=async t=>{if(t.preventDefault(),!ce())return;const r=new FormData;r.append("File",H.File),m(!0);try{const a=await p.post("/tax/importexcel",r);g.success(a.data.successMessage||"File uploaded successfully!"),$(),O(P)}catch{g.error("Something went wrong! Please try again.")}finally{m(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(Ae,{}),re&&e.jsx("div",{className:"modal fade show",style:{display:"block",backgroundColor:"rgba(0, 0, 0, 0.5)",transition:"opacity 0.3s ease-in-out"},tabIndex:"-1",role:"dialog",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content border-0 shadow-lg rounded-4 animate__animated animate__fadeInDown",children:[e.jsxs("div",{className:"modal-header bg-danger text-white rounded-top-4",children:[e.jsxs("h5",{className:"modal-title d-flex align-items-center gap-2",children:[e.jsx(be,{}),"Confirm Deletion"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:_})]}),e.jsx("div",{className:"modal-body text-center",children:e.jsxs("p",{className:"fs-5 mb-0",children:["Are you sure you want to delete"," ",e.jsx("strong",{children:v==null?void 0:v.name}),"?"]})}),e.jsxs("div",{className:"modal-footer justify-content-center border-0 pb-4",children:[e.jsxs("button",{type:"button",className:"btn btn-secondary rounded text-white px-4 d-flex align-items-center gap-2",onClick:_,children:[e.jsx(Ne,{}),"Cancel"]}),e.jsxs("button",{type:"button",className:"btn btn-danger text-white rounded px-4 shadow d-flex align-items-center gap-2",onClick:xe,children:[e.jsx(ye,{}),"Yes, Delete"]})]})]})})}),ae?e.jsxs("div",{className:"d-flex justify-content-center",style:{marginTop:"20%"},children:[e.jsx(A,{animation:"grow",variant:"secondary",size:"sm"}),e.jsx(A,{animation:"grow",variant:"warning"}),e.jsx(A,{animation:"grow",variant:"secondary",size:"sm"}),e.jsx(A,{animation:"grow",variant:"warning"})]}):e.jsx("div",{className:"d-flex",children:e.jsx("div",{className:"p-3",style:{width:"100vw"},children:e.jsx("div",{style:{width:"100%"},children:e.jsx(je,{columns:ue,data:z.filterItems(K,Z,M),pagination:!0,paginationPerPage:z.paginationPerPage,paginationRowsPerPageOptions:z.paginationRowsPerPageOptions,progressPending:Y,subHeader:!0,fixedHeaderScrollHeight:"400px",subHeaderComponent:he,persistTableHead:!0})})})}),e.jsxs(x,{show:ee,onHide:U,placement:"end",backdrop:"false",style:{"--bs-offcanvas-width":"800px"},children:[e.jsx(x.Header,{closeButton:!0,children:e.jsx("div",{className:"w-100 text-center",children:e.jsx(x.Title,{style:{fontSize:"30px",fontWeight:600},children:w?"Edit Tax":"Add Tax"})})}),e.jsx(x.Body,{style:{marginTop:"-2vh"},children:e.jsxs(c,{className:"h-90",onSubmit:fe,children:[e.jsxs(l,{className:"mb-4",children:[e.jsx(l.Text,{id:"taxName",children:e.jsx(Ie,{size:25,color:"#ffc800"})}),e.jsx(c.Control,{name:"taxName",value:o.taxName||"",onChange:t=>f("taxName",t.target.value),placeholder:"Tax name","aria-label":"taxName",isInvalid:!!s.taxName,isValid:o.taxName&&!s.taxName}),s.taxName&&e.jsx("span",{className:"error-msg",children:s.taxName})]}),e.jsxs(l,{className:"mb-4",children:[e.jsx(l.Text,{id:"taxRate",children:e.jsx(b,{size:25,color:"#ffc800"})}),e.jsx(c.Control,{name:"taxRate",value:o.taxRate||"",onChange:t=>{/^\d*\.?\d*$/.test(t.target.value)&&f("taxRate",t.target.value)},placeholder:"Tax rate","aria-label":"taxRate",isInvalid:!!s.taxRate,isValid:o.taxRate&&!s.taxRate}),s.taxRate&&e.jsx("span",{className:"error-msg",children:s.taxRate})]}),e.jsxs(l,{className:"mb-4",children:[e.jsx(l.Text,{id:"fromAmount",children:e.jsx(b,{size:25,color:"#ffc800"})}),e.jsx(c.Control,{name:"fromAmount",value:o.fromAmount||"",onChange:t=>{/^\d*\.?\d*$/.test(t.target.value)&&f("fromAmount",t.target.value)},placeholder:"From amount","aria-label":"fromAmount",isInvalid:!!s.fromAmount,isValid:o.fromAmount&&!s.fromAmount}),s.fromAmount&&e.jsx("span",{className:"error-msg",children:s.fromAmount})]}),e.jsxs(l,{className:"mb-4",children:[e.jsx(l.Text,{id:"toAmount",children:e.jsx(b,{size:25,color:"#ffc800"})}),e.jsx(c.Control,{name:"toAmount",value:o.toAmount||"",onChange:t=>{/^\d*\.?\d*$/.test(t.target.value)&&f("toAmount",t.target.value)},placeholder:"To amount","aria-label":"toAmount",isInvalid:!!s.toAmount,isValid:o.toAmount&&!s.toAmount}),s.toAmount&&e.jsx("span",{className:"error-msg",children:s.toAmount})]}),e.jsxs(l,{className:"mb-4",children:[e.jsx(l.Text,{id:"restrictedFrom",children:e.jsx(b,{size:25,color:"#ffc800"})}),e.jsx(c.Control,{name:"restrictedFrom",value:o.restrictedFrom||"",onChange:t=>{/^\d*\.?\d*$/.test(t.target.value)&&f("restrictedFrom",t.target.value)},placeholder:"Restricted From","aria-label":"restrictedFrom",isInvalid:!!s.restrictedFrom,isValid:o.restrictedFrom&&!s.restrictedFrom}),s.restrictedFrom&&e.jsx("span",{className:"error-msg",children:s.restrictedFrom})]}),e.jsxs(l,{className:"mb-4",children:[e.jsx(l.Text,{id:"restrictedTo",children:e.jsx(b,{size:25,color:"#ffc800"})}),e.jsx(c.Control,{name:"restrictedTo",value:o.restrictedTo||"",onChange:t=>{/^\d*\.?\d*$/.test(t.target.value)&&f("restrictedTo",t.target.value)},placeholder:"Restricted To","aria-label":"restrictedTo",isInvalid:!!s.restrictedTo,isValid:o.restrictedTo&&!s.restrictedTo}),s.restrictedTo&&e.jsx("span",{className:"error-msg",children:s.restrictedTo})]}),e.jsxs(l,{className:"mb-3",children:[e.jsx(l.Text,{id:"isActive",children:e.jsx(Re,{size:25,color:"#ffc800"})}),e.jsxs(c.Check,{type:"checkbox",id:"custom-checkbox",label:"IsActive",name:"isActive",className:"ms-3",style:{display:"flex",alignItems:"center",fontSize:"1rem"},custom:"true",children:[e.jsx(c.Check.Input,{type:"checkbox",checked:o.isActive,style:{width:"20px",height:"20px",cursor:"pointer",marginRight:"8px"}}),e.jsx(c.Check.Label,{htmlFor:"custom-checkbox",children:"IsActive"})]})]}),e.jsx("div",{className:"d-flex justify-content-center mt-4",children:e.jsx(N,{type:"submit",variant:"warning",children:w?"Update":"Save"})})]})})]}),e.jsxs(x,{show:te,onHide:$,backdrop:"static",placement:"end",children:[e.jsx(x.Header,{closeButton:!0,children:e.jsx("div",{className:"w-100 text-center",children:e.jsx(x.Title,{style:{fontSize:"30px",fontWeight:600},children:"Add File"})})}),e.jsx(x.Body,{style:{marginTop:"-2vh"},children:e.jsxs(c,{className:"h-90",children:[e.jsxs(l,{className:"mb-3",children:[e.jsx(l.Text,{children:e.jsx(Fe,{size:25,color:"#ffc800"})}),e.jsx(c.Control,{type:"file",accept:".xlsx",name:"File",onChange:t=>{const r=t.target.files[0];ie("File",r)}}),V.File&&e.jsx("span",{className:"error-msg",children:V.File})]}),e.jsx("div",{className:"d-flex justify-content-center mt-5",children:e.jsx(N,{type:"submit",variant:"warning",onClick:pe,children:"Save"})})]})})]})]})};export{Xe as default};
