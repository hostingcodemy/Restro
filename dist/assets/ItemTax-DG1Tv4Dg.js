import{e as W,r as m,u as A,j as e}from"./index-BwjIhAk5.js";import{T as F,e as D,d as b}from"./index-D0LwIwlf.js";import{r as H}from"./index-6cARXTD6.js";import{d as M,e as U}from"./index-D6nvb1sw.js";import{H as _}from"./index-BLfT6YWF.js";import{a as I}from"./AxiosInterceptor-C0G1OxbU.js";import{L as G,y as S}from"./index-DBZWtKGJ.js";import"./iconBase-i6NgAem3.js";const Z=()=>{const f=W(),T=m.useRef(!1),C=A(),{itemData:x,outletData:r}=C.state||{},[u,y]=m.useState([]),[n,h]=m.useState([]),[g,k]=m.useState(""),[o,N]=m.useState(1),p=5;m.useEffect(()=>{T.current||(T.current=!0,O())},[]);const O=async()=>{var s,a;try{const t=await I.get("/tax"),l=(a=(s=t==null?void 0:t.data)==null?void 0:s.list)==null?void 0:a.sort((c,i)=>new Date(i.createdDate)-new Date(c.createdDate));y(l)}catch(t){console.error("Error fetching tax data",t)}};m.useEffect(()=>{if(x&&(r!=null&&r.length)){const s=r.map((a,t)=>({id:t+1,itemName:x.itemName||"Unnamed Item",itemImage:x.itemImage||"src/assets/default.png",outletName:a.outletName||"Unnamed Outlet",selectedTaxes:[],isTaxWithDiscount:a.isTaxWithDiscount||!1}));h(s)}},[x,r]);const P=s=>{k(s.target.value),N(1)},w=(s,a)=>{const t=[...j],l=n.findIndex(d=>d.id===t[s].id),c=n[l],i=c.selectedTaxes.includes(a);c.selectedTaxes=i?c.selectedTaxes.filter(d=>d!==a):[...c.selectedTaxes,a],h([...n])},B=s=>{const a=[...j],t=n.findIndex(i=>i.id===a[s].id),l=n[t],c=u.every(i=>l.selectedTaxes.includes(i.taxId));l.selectedTaxes=c?[]:u.map(i=>i.taxId),h([...n])},E=s=>u.every(a=>s.selectedTaxes.includes(a.taxId)),j=n.filter(s=>s.itemName.toLowerCase().includes(g.toLowerCase())||s.outletName.toLowerCase().includes(g.toLowerCase())),v=Math.ceil(j.length/p),L=j.slice((o-1)*p,o*p),R=async()=>{if(!x||!r)return;const s=r.map((t,l)=>{var i;const c=n.find(d=>d.outletName===t.outletName);return{outletId:t.outletId,prices:t.prices||[],taxes:((i=c==null?void 0:c.selectedTaxes)==null?void 0:i.map(d=>({taxId:d,isActive:!0})))||[]}}),a={item:{...x,mappings:s}};try{const t=await I.post("/items",a);S.success(t.data.successMessage||"Success!",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0}),setTimeout(()=>{f("/items")},3e3)}catch{S.error(res.data.ErrorMessage||"Something went wrong! Please try again.",{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})}};return e.jsxs("div",{className:"d-flex overflow-hidden",children:[e.jsx(G,{}),e.jsx("div",{className:"configurationFormContainer",children:e.jsxs("div",{className:"configurationFormWrapper",children:[e.jsxs("div",{className:"d-flex flex-column gap-3",children:[e.jsx("div",{className:"configurationgroupFormHeader",children:e.jsxs("h2",{children:["Tax ",e.jsx("span",{children:"Setup"})]})}),e.jsx("input",{type:"text",placeholder:"Search by item or outlet name",value:g,onChange:P,className:"form-control mb-3"}),e.jsxs("div",{className:"table-container shadow-sm rounded-2",children:[e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{className:"serialNo",children:[e.jsx(H,{})," Sl No"]}),e.jsxs("th",{className:"item",children:[e.jsx(M,{})," Item Name"]}),e.jsxs("th",{className:"outletHeading",children:[e.jsx(U,{})," Outlet"]}),e.jsxs("th",{className:"taxWithDiscount",children:[e.jsx(F,{}),"Tax with Discount"]}),e.jsxs("th",{className:"taxType",children:[e.jsx(_,{})," Selected Taxes"]})]})}),e.jsx("tbody",{children:L.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"serialNo",children:(o-1)*p+a+1}),e.jsx("td",{className:"itemRow",children:e.jsxs("div",{className:"item-info",children:[e.jsx("img",{src:s.itemImage,alt:s.itemName}),e.jsx("div",{children:s.itemName})]})}),e.jsx("td",{className:"outletrow",children:e.jsx("span",{className:"outletName",children:s.outletName})}),e.jsx("td",{className:"taxDiscount",children:e.jsx("input",{type:"checkbox",checked:s.isTaxWithDiscount,onChange:()=>{const t=[...n];t.find(l=>l.id===s.id).isTaxWithDiscount=!s.isTaxWithDiscount,h(t)}})}),e.jsx("td",{children:e.jsxs("div",{className:"tax-buttons",children:[e.jsx("button",{className:E(s)?"taxBtn taxSelected":"taxBtn",onClick:()=>B(a),children:"All"}),u.map(t=>e.jsx("button",{className:s.selectedTaxes.includes(t.taxId)?"taxBtn taxSelected":"taxBtn",onClick:()=>w(a,t.taxId),children:t.taxName},t.taxId))]})})]},s.id))})]}),e.jsxs("div",{className:"pagination",children:[e.jsx("span",{onClick:()=>o>1&&N(o-1),children:e.jsx(D,{})}),e.jsxs("div",{children:["Page ",o," of ",v]}),e.jsx("span",{onClick:()=>o<v&&N(o+1),children:e.jsx(b,{})})]})]})]}),e.jsxs("div",{className:"bottomBtn d-flex align-items-center justify-content-between",children:[e.jsxs("div",{className:"prevBtn",onClick:()=>f("/itemOutlet"),children:[e.jsx("div",{className:"prevIcon",children:e.jsx(D,{})}),"Previous"]}),e.jsxs("div",{className:"nextBtn",onClick:R,children:["Submit ",e.jsx("div",{className:"nextIcon",children:e.jsx(b,{})})]})]})]})})]})};export{Z as default};
